{% extends 'blog/base.html' %}
{% load typogrify %}
{% load custom_html %}
{% load comment_utils %}
{% load more %}
{% load images %}

{% block head-code %}
<link rel="alternate" type="application/rss+xml" title="Latest posts from {{ blog.title }} (RSS 2.0)" href="/rss/blogs/{{ blog.slug }}/" />
{% endblock head-code %}

{% block title %}{{ block.super }}{% endblock title %}

	{% block breadcrumb %}
		<a href="{% url journal.stories.views.index_latest %}">Home</a> &raquo; <a href="{% url journal.blog.views.all_blogs %}">Blogs</a> &raquo; {{ blog.title }}
	{% endblock breadcrumb %}
	{% block actions %}
		<div id="actions"><p><span id="actions-rss" class="action"><a href="/rss/blogs/{{ blog.slug }}/">Latest posts RSS <img src="/media/global/icon_rss.gif" /></a></span></p></div>
	{% endblock actions %}
	{% block blog-filter %}
		{% spaceless %}
		{% if month or author or category or query %}<h3>
		{% if month %}All posts published in {{ month|date:"F Y" }}
		{% else %}{% if author %}All posts written by {{ author.user.first_name }}
		{% else %}{% if category %}All posts in {{ category.name }}
		{% else %}{% if query %}{{ hits }} result{{ hits|pluralize }} for &ldquo;{{ query }}&rdquo; (showing results {{ first_on_page}}&ndash;{{ last_on_page }})
		{% endif %}
		{% endif %}
		{% endif %}
		{% endif %}
		</h3>{% endif %}
		{% endspaceless %}
	{% endblock blog-filter %}
	{% block blog-content %}
	<div id="blog-entries" class="blog-content">
		{% for entry in object_list %}
		<div id="entry-{{ entry.id }}" class="blog-container">
			<h2><a href="{{ entry.get_absolute_url }}">{{ entry.title }}</a></h2>
			<h5>Posted by <a href="{{ entry.author.get_absolute_url }}">{{ entry.author.user.get_full_name }}</a> on {{ entry.date_published|date:"F j, Y @ h:i a T" }}</h5>
			<p>Categories: {% for category in entry.categories.all %}<a href="{% url blog_archive_category_front blog.slug,category.slug %}">{{ category.name }}</a>{% if not forloop.last %}, {% endif %}{% endfor %}</p>
			<div class="blog-post-content">{{ entry.content|more:entry.id|images:435|removetags:"font"|typogrify|linebreakswithcode }}</div>

			{% get_public_free_comment_count for blog.entry entry.id as comment_count %}
			<p class="blog-post-commentlink"><a href="{{ entry.get_absolute_url }}#comments">{% ifequal comment_count 0 %}No{% else %}{{ comment_count }}{% endifequal %} comment{{ comment_count|pluralize }}</a></p>
		</div>
		{% endfor %}
	</div>
	
	{% if has_next %}<div id="blog-prev" class="side-action">
		{% if author %}<a href="{% url blog_archive_author_pages blog.slug,author.id,next %}">
		{% else %}{% if category %}<a href="{% url blog_archive_category_pages blog.slug,category.slug,next %}">
		{% else %}{% if month %}<a href="{% url blog_archive_month_pages blog.slug,month.year,month|date:"m",next %}">
		{% else %}{% if query %}<a href="{% url blog_search blog.slug %}?s={{ query }}&page={{ next }}">
		{% else %}<a href="{% url blog_index_pages blog.slug,next %}">
		{% endif %}
		{% endif %}
		{% endif %}
		{% endif %}
		&laquo; Older posts</a></div>
	{% else %}{% if not has_next and prev_month %}<div id="blog-prev" class="side-action"><a href="{% url blog_archive_month_front prev_month.year,prev_month|date:"m" %}">&laquo; To {{ prev_month|date:"F Y" }}</a></div>{% endif %}
	{% endif %}
	{% if has_previous %}<div id="blog-next" class="side-action">
		{% if author %}<a href="{% url blog_archive_author_pages blog.slug,author.id,previous %}">
		{% else %}{% if category %}<a href="{% url blog_archive_category_pages blog.slug,category.slug,previous %}">
		{% else %}{% if month %}<a href="{% url blog_archive_month_pages blog.slug,month.year,month|date:"m",previous %}">
		{% else %}{% if query %}<a href="{% url blog_search blog.slug %}?s={{ query }}&page={{ previous }}">
		{% else %}<a href="{% url blog_index_pages blog.slug,previous %}">
		{% endif %}
		{% endif %}
		{% endif %}
		{% endif %}
		Newer posts &raquo;</a></div>
	{% else %}{% if not has_previous and next_month %}<div id="blog-next" class="side-action"><a href="{% url blog_archive_month_front next_month.year,next_month|date:"m" %}">To {{ next_month|date:"F Y" }} &raquo;</a></div>{% endif %}
	{% endif %}

	{% endblock blog-content %}

