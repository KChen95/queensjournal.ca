{% extends 'staff/base.html' %}
{% load flash %}
{% load custom_html %}
{% block title %} - Viewing 
	{% if not query and not status and not parent %}all comments
	{% else %}{% if query %}comment search results for "{{ query|escape }}"
	{% else %}{% if status %}{{ status|escape }} comments
	{% else %}{% if parent %}comments for &ldquo;{% firstof parent.head '(deleted story?)' %}&rdquo;
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}
{% endblock title %}
{% block staffapp %}Comment moderation queue{% endblock staffapp %}
{% block header %}
	{% if not query and not status and not parent %}All <span class="published">published</span> and <span class="moderated">moderated</span> comments
	{% else %}{% if query %}Search results for "{{ query|escape }}"
	{% else %}{% if status %}<span class="{{ status }}">{{ status|escape|capfirst }}</span> comments
	{% else %}{% if parent %}Comments for &ldquo;{% filter stripspace %}{% firstof parent.head '(deleted story?)' %}{% endfilter %}&rdquo;
	{% endif %}
	{% endif %}
	{% endif %}
	{% endif %}
{% endblock header %}

{% block content %}
{% flash %}
<div class="flash {{ params.type }}">{{ msg }}</div>
{% endflash %}
<table id="objects-list">
	<thead>
		{% if is_paginated %}
		<tr>
			<td colspan="{% if edit_comment and delete_comment %}5{% else %}{% if edit_comment and not delete_comment %}4{% else %}3{% endif %}{% endif %}">page {{ page }} of {{ pages }}</td>
		</tr>
		{% endif %}
		<tr>
			<td>Comment</td>
			{% if edit_comment %}<td class="list-edit"{% if delete_comment %} colspan="2"{% endif %}>Actions</td>{% endif %}
		</tr>
	</thead>
	<tbody>
	{% for object in object_list|dictsortreversed:"submit_date" %}
		{% ifchanged object.submit_date.date %}
			<tr class="list-date-divider"><td colspan="{% if approve_comment and delete_comment %}5{% else %}{% if approve_comment and not delete_comment %}4{% else %}3{% endif %}{% endif %}">{{ object.submit_date|date:"F j, Y" }}</td></tr>
		{% endifchanged %}



		<tr class="object_row item-top {% if object.is_public %}published{% else %}{% if object.approved %}moderated{% else %}deleted{% endif %}{% endif %}">
			<td>
				Posted by <strong title="{{ object.person_email }}">{{ object.person_name|escape }}</strong> 
				at <a href="{% url journal.staff.commentmod.views.comment_edit object.id %}">{{ object.submit_date|date:"P" }}</a><br/>
				to {% if object.get_content_object.head %}Journal story:{% else %}{% if object.get_content_object.title %}blog entry:{% endif %}{% endif %} 
				<a href="{{ object.get_content_object.get_absolute_url }}">{% firstof object.get_content_object.head object.get_content_object.title %}</a>
			</td>
			{% if approve_comment %}
				<td class="list-approve" rowspan="2">
				{% if not object.is_public and object.approved %}
					<form action="{% url journal.staff.commentmod.views.comment_quickaction %}" method="post">
						<input type="hidden" name="comment" value="{{ object.id }}" />
						<input type="hidden" name="action" value="publish" />
						<input type="hidden" name="url" value="{{ request.get_full_path }}" />
						<button type="submit">Publish</button>
					</form>
				{% else %}{% if object.is_public %}
					<form action="{% url journal.staff.commentmod.views.comment_quickaction %}" method="post">
						<input type="hidden" name="comment" value="{{ object.id }}" />
						<input type="hidden" name="action" value="moderate" />
						<input type="hidden" name="url" value="{{ request.get_full_path }}" />
						<button type="submit">Moderate</button>
					</form>
				{% endif %}{% endif %}
				</td>
			{% endif %}
			{% if delete_comment %}
				<td class="list-delete" rowspan="2">
				{% if object.approved %}
					<form action="{% url journal.staff.commentmod.views.comment_quickaction %}" method="post">
						<input type="hidden" name="comment" value="{{ object.id }}" />
						<input type="hidden" name="action" value="delete" />
						<input type="hidden" name="url" value="{{ request.get_full_path }}" />
						<button type="submit">Delete</button>
					</form>
					{% else %}{% if not object.is_public and not object.approved %}
					<form action="{% url journal.staff.commentmod.views.comment_quickaction %}" method="post">
						<input type="hidden" name="comment" value="{{ object.id }}" />
						<input type="hidden" name="action" value="undelete" />
						<input type="hidden" name="url" value="{{ request.get_full_path }}" />
						<button type="submit">Undelete</button>
					</form>
				{% endif %}{% endif %}
				</td>
			{% endif %}
		</tr>
		<tr class="item-bottom {% if object.is_public %}published{% else %}{% if object.approved %}moderated{% else %}deleted{% endif %}{% endif %}">
			<td class="list-comment"><p>{{ object.comment|escape|truncatewords:30 }}</p></td>
		</tr>
	{% endfor %}
	</tbody>
	<tfoot>
		<tr>
			<td colspan="{% if approve_comment and delete_comment %}5{% else %}{% if approve_comment and not delete_comment %}4{% else %}3{% endif %}{% endif %}" class="clearfix">
				{% if has_previous %}
				<a href="{{ request.path }}?{% for param in request.GET.items %}{% ifnotequal param.0 "page" %}{{ param.0 }}={{ param.1 }}&{% endifnotequal %}{% endfor %}page={{ previous }}" id="nav-previous">&laquo; previous</a>{% endif %}
				{% if has_next %}<a href="{{ request.path }}?{% for param in request.GET.items %}{% ifnotequal param.0 "page" %}{{ param.0 }}={{ param.1 }}&{% endifnotequal %}{% endfor %}page={{ next }}" id="nav-next">next &raquo;</a>{% endif %}
			</td>
		</tr>
	</tfoot>
</table>
{% endblock content %}

{% block sidebar %}
<div>
{% if status or query or section %}
	<p><a href="{% url journal.staff.commentmod.views.comment_index %}">View all comments</a></p>
{% endif %}
</div>
<div id="search">
	<form action="" method="get">
		<input type="text" name="s" onblur="if(this.value=='') this.value = 'Search';" onfocus="if(this.value=='Search') this.value = '';" value="Search" />
	</form>
</div>
<div id="filter-status" class="filters">
	<p class="filter-type">By status</p>
	<ul>
		<li{% ifequal status 'published' %} class="selected"{% endifequal %}><a href="?status=published">Published</a></li>
		<li{% ifequal status 'moderated' %} class="selected"{% endifequal %}><a href="?status=moderated">Moderated</a></li>
		<li{% ifequal status 'deleted' %} class="selected"{% endifequal %}><a href="?status=deleted">Deleted</a></li>
	</ul>
</div>
{% if not query and not status and not parent %}<div class="filters"><p>By default, deleted comments aren't shown in the main view.</p></div>{% endif %}
{% endblock sidebar %}
